id: thirdwing_node_programma_to_repertoire
label: 'Content: Programma → Repertoire (VERVALT als apart type)'
migration_group: thirdwing
migration_tags:
  - Drupal 6
  - Content

source:
  plugin: d6_node
  node_type: programma
  
process:
  nid: nid
  vid: vid
  type:
    plugin: default_value
    default_value: repertoire
  
  langcode:
    plugin: default_value
    default_value: nl
  
  title: title
  
  uid:
    plugin: migration_lookup
    migration: thirdwing_user
    source: uid
  
  status: status
  created: created
  changed: changed
  promote: promote
  sticky: sticky
  
  # Workflow state mapping (was Workflow 4, now uses Repertoire workflow)
  moderation_state:
    plugin: workflow_state_mapper
    source: workflow_stamp
  
  # Programma type → Repertoire soort mapping
  field_repertoire_soort:
    plugin: static_map
    source: field_prog_type
    map:
      programma: 'Programma-onderdeel'
      nummer: 'Overig'
    default_value: 'Programma-onderdeel'
  
  # Andere Repertoire velden krijgen standaard/lege waarden
  # zodat ze consistent zijn met echte Repertoire nodes
  
  # Toegang taxonomy
  field_toegang:
    plugin: sub_process
    source: taxonomy
    process:
      target_id:
        plugin: migration_lookup
        migration: thirdwing_taxonomy_toegang
        source: tid

destination:
  plugin: entity:node
  default_bundle: repertoire
  overwrite_properties:
    - title
    - uid
    - status
    - created
    - changed
    - field_repertoire_soort
    - field_toegang

migration_dependencies:
  required:
    - thirdwing_user
  optional:
    - thirdwing_taxonomy_toegang
